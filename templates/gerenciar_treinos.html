{% extends 'base.html' %}

{% block title %}Treinos de {{ aluno.nome }}{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto">
    <!-- Cabeçalho com nome do aluno e botão de voltar -->
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold text-gray-800">Gerenciar Treinos de: <span class="text-purple-700">{{ aluno.nome }}</span></h1>
        <a href="{{ url_for('perfil_aluno', aluno_id=aluno.id) }}" class="text-blue-500 hover:underline">Voltar ao Perfil</a>
    </div>

    <!-- Seção para Criar Novo Treino -->
    <div class="bg-white p-6 shadow-lg rounded-lg mb-8">
        <h2 class="text-2xl font-semibold text-gray-700 mb-4">Criar Nova Ficha de Treino</h2>
        <form action="{{ url_for('novo_treino', aluno_id=aluno.id) }}" method="post" class="flex items-center space-x-4">
            <div class="flex-grow">
                <label for="nome_treino" class="block font-medium text-gray-700">Nome do Treino (Ex: Treino A, Ficha 1)</label>
                <input type="text" name="nome_treino" id="nome_treino" class="w-full border border-gray-300 rounded-md p-2 mt-1" required>
            </div>
            <button type="submit" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded self-end">Criar Treino</button>
        </form>
    </div>

    <!-- Seção para Listar Treinos Existentes -->
    <div class="space-y-8">
        <h2 class="text-2xl font-semibold text-gray-700">Fichas de Treino Cadastradas</h2>
        {% for treino in aluno.treinos %}
            <div class="bg-white p-6 shadow-lg rounded-lg">
                <!-- Cabeçalho do Treino (Nome e botão de excluir) -->
                <div class="flex justify-between items-center border-b pb-4 mb-4">
                    <h3 class="text-2xl font-bold text-purple-800">{{ treino.nome }}</h3>
                    <form action="{{ url_for('excluir_treino', treino_id=treino.id) }}" method="post" onsubmit="return confirm('Tem certeza que deseja excluir este treino inteiro?');">
                        <button type="submit" class="text-red-500 hover:text-red-700 text-sm font-medium">Excluir Ficha</button>
                    </form>
                </div>

                <!-- Lista de Exercícios neste Treino -->
                <div class="space-y-3 mb-6">
                    <h4 class="text-lg font-semibold text-gray-600">Exercícios Adicionados:</h4>
                    {% if treino.itens %}
                        <ul class="divide-y divide-gray-200">
                            {% for item in treino.itens %}
                                <li class="py-3 flex justify-between items-center">
                                    <div>
                                        <p class="font-semibold text-gray-800">{{ item.exercicio.nome }}</p>
                                        <p class="text-sm text-gray-500">
                                            <span>Séries: <strong>{{ item.series or 'N/A' }}</strong></span> |
                                            <span>Repetições: <strong>{{ item.repeticoes or 'N/A' }}</strong></span> |
                                            <span>Descanso: <strong>{{ item.descanso_seg or 'N/A' }}s</strong></span>
                                        </p>
                                        <p class="text-sm text-gray-500">Obs: {{ item.observacoes or 'Nenhuma' }}</p>
                                    </div>
                                    <form action="{{ url_for('excluir_item_treino', item_id=item.id) }}" method="post" onsubmit="return confirm('Remover este exercício do treino?');">
                                        <button type="submit" class="bg-red-100 text-red-700 hover:bg-red-200 text-xs font-bold py-1 px-2 rounded-full">Remover</e>
                                    </form>
                                </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <p class="text-gray-500">Nenhum exercício adicionado a este treino ainda.</p>
                    {% endif %}
                </div>

                <!-- Formulário para Adicionar Novos Exercícios a ESTE Treino -->
                <div class="border-t pt-4">
                    <h4 class="text-lg font-semibold text-gray-600 mb-3">Adicionar Exercício ao Treino: {{ treino.nome }}</h4>
                    <form action="{{ url_for('adicionar_item_treino', treino_id=treino.id) }}" method="post" class="grid grid-cols-1 md:grid-cols-6 gap-3">
                        <div class="md:col-span-2">
                            <label for="exercicio_id" class="block text-sm font-medium text-gray-700">Exercício</label>
                            <select name="exercicio_id" id="exercicio_id" class="w-full border border-gray-300 rounded-md p-2 mt-1" required>
                                <option value="" disabled selected>Selecione um exercício...</option>
                                {% for ex in exercicios_disponiveis %}
                                    <option value="{{ ex.id }}">{{ ex.nome }} ({{ ex.grupo_muscular }})</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div>
                            <label for="series" class="block text-sm font-medium text-gray-700">Séries</label>
                            <input type="text" name="series" id="series" class="w-full border border-gray-300 rounded-md p-2 mt-1" placeholder="Ex: 4">
                        </div>
                        <div>
                            <label for="repeticoes" class="block text-sm font-medium text-gray-700">Repetições</label>
                            <input type="text" name="repeticoes" id="repeticoes" class="w-full border border-gray-300 rounded-md p-2 mt-1" placeholder="Ex: 10-12">
                        </div>
                        <div>
                            <label for="descanso_seg" class="block text-sm font-medium text-gray-700">Descanso (s)</label>
                            <input type="number" name="descanso_seg" id="descanso_seg" class="w-full border border-gray-300 rounded-md p-2 mt-1" placeholder="Ex: 60">
                        </div>
                        <div class="md:col-span-6">
                            <label for="observacoes" class="block text-sm font-medium text-gray-700">Observações</label>
                            <input type="text" name="observacoes" id="observacoes" class="w-full border border-gray-300 rounded-md p-2 mt-1" placeholder="Ex: Aumentar carga, cadência 2-2, etc.">
                        </div>
                        <div class="md:col-span-6">
                            <button type="submit" class="w-full md:w-auto bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-4 rounded">Adicionar ao Treino</button>
                        </div>
                    </form>
                </div>
            </div>
        {% else %}
            <div class="bg-white p-6 shadow-lg rounded-lg text-center">
                <p class="text-gray-500">Este aluno ainda não possui nenhuma ficha de treino.</p>
            </div>
        {% endfor %}
    </div>
</div>
{% endblock %}